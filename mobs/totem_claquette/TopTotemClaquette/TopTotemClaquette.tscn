[gd_scene load_steps=42 format=3 uid="uid://b6t12ei2nosv6"]

[ext_resource type="Texture2D" uid="uid://nmq3nd4q0qnv" path="res://mobs/totem_claquette/Animations/Animations.png" id="1_1q3y5"]
[ext_resource type="Texture2D" uid="uid://jvds3dhxovh7" path="res://mobs/Boss/Ecureuil/Animation/Death/Death.png" id="1_130ox"]
[ext_resource type="Texture2D" uid="uid://d1jusd0hbfuu0" path="res://mobs/totem_claquette/Animations/Animations - Copie.png" id="1_ta6y5"]

[sub_resource type="GDScript" id="GDScript_omxb6"]
script/source = "extends CharacterBody2D

@export var speed=100
@onready var animation=$AnimationPlayer
@export var stun_time:float=1.0
var projectile = preload(\"res://mobs/totem_claquette/projectile/totem_claquette_projectile.tscn\")
var gravity = ProjectSettings.get_setting(\"physics/2d/default_gravity\")
var player_chase = false
var player = null
var totem=null
var self_width = null
var self_lenght=null
var lenght_bottom_totem=null
var width_bottom_totem=null
var fusion = false
var projectile_direction=null
var on_bottom_totem=false
enum STATE {
	CHASE,
	MERGE,
	WAITING,
	BACK_TO_POSITION,
}
var TopTotemState=STATE.WAITING
# Called when the node enters the scene tree for the first time.
func _ready():
	self_width = get_node(\"HitboxTopTotem\").shape.extents.y * 2
	self_lenght=get_node(\"HitboxTopTotem\").shape.extents.x * 2

# Called every frame. 'delta' is the elapsed time since the previous frame.
func _process(delta):
	velocity.y += gravity * delta # Apply the gravity
	match TopTotemState:
		STATE.WAITING:
			velocity.x=0
		STATE.CHASE:
			chase_player()
		STATE.MERGE:
			totem_merge(delta)
		STATE.BACK_TO_POSITION:
			pass
	#Test if totem is merging
	if fusion==true:
		totem_merge(delta)
	elif (player_chase==true) and (player!=null):#If there are not merging, it chase the player
		chase_player()
	move_and_slide()
	#print(velocity)
	#print(STATE.keys()[TopTotemState])

#If a bottom totem is in the area, they merge
func _on_detection_area_bottom_totem_body_entered(body):
	if body.is_in_group(\"BottomTotemClaquette\") and body != self:
		totem=body
		fusion=true
		TopTotemState=STATE.MERGE
		width_bottom_totem=totem.get(\"self_width\")
		lenght_bottom_totem=totem.get(\"self_lenght\")


func _on_detection_area_bottom_totem_body_exited(body):
	if body.is_in_group(\"BottomTotemClaquette\") and body != self:
		totem=null
		fusion=false
		on_bottom_totem=false


func _on_detection_area_player_body_entered(body):
	if body.is_in_group(\"Player\"):
		player = body
		player_chase = true
		$ProjectileTimer.start()


func _on_detection_area_player_body_exited(body):
	if body.is_in_group(\"Player\"):
		player = null
		player_chase = false
		$ProjectileTimer.stop()
		

# Function to merge the totems
func totem_merge(delta):
	if totem!=null:
		$ProjectileTimer.stop()
		player_chase = false  # Stop chasing the player
		var final_pos=totem.global_position
		final_pos.y=final_pos.y-width_bottom_totem-0.1
		var direction = final_pos - global_position
		var distance_to_target = direction.length()
			# Si l'ennemi est très proche de la position initiale, on l'arrête
		if distance_to_target < 0.15:  # Tolérance pour considérer que l'ennemi est arrivé
			velocity = Vector2()  # Stoppe le mouvement
			global_position = final_pos  # Assure que l'ennemi est bien à sa position initiale
			TopTotemState=STATE.CHASE
			fusion=false
			player_chase=true
			on_bottom_totem=true
			$ProjectileTimer.start()
		else:
			# Normalise la direction et ajuste la vitesse en conséquence
			direction = direction.normalized()
			velocity.x = direction.x * speed
			if distance_to_target <50:
				velocity.y=direction.y*speed
		# Mise à jour de la position en fonction de la vélocité calculée
		global_position += velocity * delta
	else:
		player_chase=true
#Function to chase the player, the totem goes towards the player and fires a projectile at regular intervals
func chase_player():
	if player_chase:
		if player!=null:
			if on_bottom_totem==true:
				var direction = (player.global_position - self.position).normalized()* speed
				var final_pos=totem.global_position
				final_pos.y=final_pos.y-width_bottom_totem-0.1
				if direction.x>0:
						animation.play(\"OnBottomTotemRight\")
						projectile_direction=true
				else:
						animation.play(\"OnBottomTotemLeft\")
						projectile_direction=false
				velocity = Vector2()  # Stoppe le mouvement
				global_position = final_pos
			elif on_bottom_totem==false:
				var direction = (player.global_position - self.position).normalized()* speed
				if direction.x>0:
						animation.play(\"WalkRight\")
						projectile_direction=true
				else:
						animation.play(\"WalkLeft\")
						projectile_direction=false
				velocity.x = sign(direction.x)*speed
	else:
		velocity = lerp(velocity, Vector2.ZERO, 0.01)
		velocity.x = 0  # Stop horizontal movement when `player_chase` is disabled

#When the timer is timeout, a projectile spawn
func _on_projectile_timer_timeout():
	var b = projectile.instantiate()
	get_tree().current_scene.add_child(b)
	b.start(position,projectile_direction)
	$ProjectileTimer.start()
	
func death():
	print(\"Death\")
	TopTotemState=STATE.WAITING
	if totem!=null:
		fusion=false
	player_chase=false
	player=null
	animation.play(\"Death\")
	await animation.animation_finished
	queue_free()



func _on_hitbox_body_entered(body):
	if body.is_in_group(\"Player\"):
		death()


func _on_area_2d_2_area_entered(area: Area2D) -> void:
		if area.is_in_group(\"Stun\"):
			stun()

func stun():
	TopTotemState=STATE.WAITING
	if totem!=null:
		fusion=false
	player_chase=false
	await get_tree().create_timer(stun_time).timeout
	if totem!=null:
		fusion=true
		player_chase=false
	else:
		player_chase=true
	print(\"Stun\")

func _on_area_2d_area_entered(area: Area2D) -> void:
		if area.is_in_group(\"Stun\"):
			stun()
"

[sub_resource type="RectangleShape2D" id="RectangleShape2D_fvexe"]
size = Vector2(18, 36)

[sub_resource type="RectangleShape2D" id="RectangleShape2D_ccwdb"]
size = Vector2(17, 5)

[sub_resource type="AtlasTexture" id="AtlasTexture_d15ln"]
atlas = ExtResource("1_130ox")
region = Rect2(0, 0, 503, 500)

[sub_resource type="AtlasTexture" id="AtlasTexture_c2pgk"]
atlas = ExtResource("1_130ox")
region = Rect2(503, 0, 503, 500)

[sub_resource type="AtlasTexture" id="AtlasTexture_lyopc"]
atlas = ExtResource("1_130ox")
region = Rect2(1006, 0, 503, 500)

[sub_resource type="AtlasTexture" id="AtlasTexture_xbufy"]
atlas = ExtResource("1_130ox")
region = Rect2(1509, 0, 503, 500)

[sub_resource type="AtlasTexture" id="AtlasTexture_i5ia6"]
atlas = ExtResource("1_130ox")
region = Rect2(2012, 0, 503, 500)

[sub_resource type="AtlasTexture" id="AtlasTexture_228ei"]
atlas = ExtResource("1_130ox")
region = Rect2(2515, 0, 503, 500)

[sub_resource type="AtlasTexture" id="AtlasTexture_1d3mx"]
atlas = ExtResource("1_130ox")
region = Rect2(3018, 0, 503, 500)

[sub_resource type="AtlasTexture" id="AtlasTexture_i1sxj"]
atlas = ExtResource("1_130ox")
region = Rect2(3521, 0, 503, 500)

[sub_resource type="AtlasTexture" id="AtlasTexture_hu6p0"]
atlas = ExtResource("1_ta6y5")
region = Rect2(0, 0, 260, 256)

[sub_resource type="AtlasTexture" id="AtlasTexture_cm532"]
atlas = ExtResource("1_ta6y5")
region = Rect2(256, 0, 250, 256)

[sub_resource type="AtlasTexture" id="AtlasTexture_ghkfx"]
atlas = ExtResource("1_ta6y5")
region = Rect2(508, 0, 251, 256)

[sub_resource type="AtlasTexture" id="AtlasTexture_yxtn1"]
atlas = ExtResource("1_ta6y5")
region = Rect2(762, 0, 252, 256)

[sub_resource type="AtlasTexture" id="AtlasTexture_jg7b6"]
atlas = ExtResource("1_ta6y5")
region = Rect2(1014, 0, 252, 256)

[sub_resource type="AtlasTexture" id="AtlasTexture_cs4ve"]
atlas = ExtResource("1_ta6y5")
region = Rect2(1257, 0, 243, 256)

[sub_resource type="AtlasTexture" id="AtlasTexture_ftrx6"]
atlas = ExtResource("1_ta6y5")
region = Rect2(1500, 0, 243, 256)

[sub_resource type="AtlasTexture" id="AtlasTexture_vh34u"]
atlas = ExtResource("1_ta6y5")
region = Rect2(1743, 0, 243, 256)

[sub_resource type="AtlasTexture" id="AtlasTexture_rtchd"]
atlas = ExtResource("1_1q3y5")
region = Rect2(24, 7, 252, 298)

[sub_resource type="AtlasTexture" id="AtlasTexture_qmm6p"]
atlas = ExtResource("1_1q3y5")
region = Rect2(277, 7, 238, 298)

[sub_resource type="AtlasTexture" id="AtlasTexture_7qsc8"]
atlas = ExtResource("1_1q3y5")
region = Rect2(521, 7, 241, 298)

[sub_resource type="AtlasTexture" id="AtlasTexture_y6tpt"]
atlas = ExtResource("1_1q3y5")
region = Rect2(771, 7, 244, 298)

[sub_resource type="AtlasTexture" id="AtlasTexture_xb814"]
atlas = ExtResource("1_1q3y5")
region = Rect2(1015, 7, 244, 298)

[sub_resource type="AtlasTexture" id="AtlasTexture_txv6i"]
atlas = ExtResource("1_1q3y5")
region = Rect2(1262, 7, 240, 298)

[sub_resource type="AtlasTexture" id="AtlasTexture_0qylw"]
atlas = ExtResource("1_1q3y5")
region = Rect2(1508, 7, 241, 298)

[sub_resource type="AtlasTexture" id="AtlasTexture_2qm1i"]
atlas = ExtResource("1_1q3y5")
region = Rect2(1742, 7, 240, 298)

[sub_resource type="SpriteFrames" id="SpriteFrames_7xa0i"]
animations = [{
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_d15ln")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_c2pgk")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_lyopc")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_xbufy")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_i5ia6")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_228ei")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_1d3mx")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_i1sxj")
}],
"loop": true,
"name": &"Death",
"speed": 5.0
}, {
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_hu6p0")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_cm532")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_ghkfx")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_yxtn1")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_jg7b6")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_cs4ve")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_ftrx6")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_vh34u")
}],
"loop": true,
"name": &"OnBottomTotem",
"speed": 5.0
}, {
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_rtchd")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_qmm6p")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_7qsc8")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_y6tpt")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_xb814")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_txv6i")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_0qylw")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_2qm1i")
}],
"loop": true,
"name": &"Walk",
"speed": 5.0
}]

[sub_resource type="RectangleShape2D" id="RectangleShape2D_8uf4e"]
size = Vector2(443, 310)

[sub_resource type="CircleShape2D" id="CircleShape2D_bgbfj"]
radius = 130.0

[sub_resource type="Animation" id="Animation_n5fbe"]
resource_name = "Death"
length = 0.8
step = 0.1
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("AnimatedSprite2D:animation")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [&"Death"]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("AnimatedSprite2D:frame")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7),
"transitions": PackedFloat32Array(1, 1, 1, 1, 1, 1, 1, 1),
"update": 1,
"values": [0, 1, 2, 3, 4, 5, 6, 7]
}

[sub_resource type="Animation" id="Animation_lc66n"]
resource_name = "OnBottomTotemLeft"
length = 0.8
loop_mode = 1
step = 0.1
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("AnimatedSprite2D:animation")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [&"OnBottomTotem"]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("AnimatedSprite2D:frame")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7),
"transitions": PackedFloat32Array(1, 1, 1, 1, 1, 1, 1, 1),
"update": 1,
"values": [0, 1, 2, 3, 4, 5, 6, 7]
}
tracks/2/type = "value"
tracks/2/imported = false
tracks/2/enabled = true
tracks/2/path = NodePath("AnimatedSprite2D:flip_h")
tracks/2/interp = 1
tracks/2/loop_wrap = true
tracks/2/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [true]
}
tracks/3/type = "value"
tracks/3/imported = false
tracks/3/enabled = true
tracks/3/path = NodePath("HitboxTopTotem:disabled")
tracks/3/interp = 1
tracks/3/loop_wrap = true
tracks/3/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [true]
}
tracks/4/type = "value"
tracks/4/imported = false
tracks/4/enabled = true
tracks/4/path = NodePath("HitboxTopTotemOnBottom:disabled")
tracks/4/interp = 1
tracks/4/loop_wrap = true
tracks/4/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [false]
}
tracks/5/type = "value"
tracks/5/imported = false
tracks/5/enabled = true
tracks/5/path = NodePath("Hitbox/HitboxTopTotem:position")
tracks/5/interp = 1
tracks/5/loop_wrap = true
tracks/5/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [Vector2(23.5, 8)]
}
tracks/6/type = "value"
tracks/6/imported = false
tracks/6/enabled = true
tracks/6/path = NodePath("HitboxTopTotemOnBottom:position")
tracks/6/interp = 1
tracks/6/loop_wrap = true
tracks/6/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [Vector2(6, 20)]
}
tracks/7/type = "value"
tracks/7/imported = false
tracks/7/enabled = true
tracks/7/path = NodePath("Area2D/HitboxTopTotemOnBottom2:disabled")
tracks/7/interp = 1
tracks/7/loop_wrap = true
tracks/7/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [false]
}
tracks/8/type = "value"
tracks/8/imported = false
tracks/8/enabled = true
tracks/8/path = NodePath("Area2D/HitboxTopTotemOnBottom2:position")
tracks/8/interp = 1
tracks/8/loop_wrap = true
tracks/8/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [Vector2(6, 20)]
}
tracks/9/type = "value"
tracks/9/imported = false
tracks/9/enabled = true
tracks/9/path = NodePath("Area2D2/HitboxTopTotem2:disabled")
tracks/9/interp = 1
tracks/9/loop_wrap = true
tracks/9/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [true]
}

[sub_resource type="Animation" id="Animation_sik2m"]
resource_name = "OnBottomTotemRight"
length = 0.8
loop_mode = 1
step = 0.1
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("AnimatedSprite2D:animation")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [&"OnBottomTotem"]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("AnimatedSprite2D:frame")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7),
"transitions": PackedFloat32Array(1, 1, 1, 1, 1, 1, 1, 1),
"update": 1,
"values": [0, 1, 2, 3, 4, 5, 6, 7]
}
tracks/2/type = "value"
tracks/2/imported = false
tracks/2/enabled = true
tracks/2/path = NodePath("AnimatedSprite2D:flip_h")
tracks/2/interp = 1
tracks/2/loop_wrap = true
tracks/2/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [false]
}
tracks/3/type = "value"
tracks/3/imported = false
tracks/3/enabled = true
tracks/3/path = NodePath("HitboxTopTotem:disabled")
tracks/3/interp = 1
tracks/3/loop_wrap = true
tracks/3/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [true]
}
tracks/4/type = "value"
tracks/4/imported = false
tracks/4/enabled = true
tracks/4/path = NodePath("HitboxTopTotemOnBottom:disabled")
tracks/4/interp = 1
tracks/4/loop_wrap = true
tracks/4/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [false]
}
tracks/5/type = "value"
tracks/5/imported = false
tracks/5/enabled = true
tracks/5/path = NodePath("Hitbox/HitboxTopTotem:position")
tracks/5/interp = 1
tracks/5/loop_wrap = true
tracks/5/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [Vector2(36.5, 8)]
}
tracks/6/type = "value"
tracks/6/imported = false
tracks/6/enabled = true
tracks/6/path = NodePath("HitboxTopTotemOnBottom:position")
tracks/6/interp = 1
tracks/6/loop_wrap = true
tracks/6/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [Vector2(19, 20)]
}
tracks/7/type = "value"
tracks/7/imported = false
tracks/7/enabled = true
tracks/7/path = NodePath("Area2D/HitboxTopTotemOnBottom2:disabled")
tracks/7/interp = 1
tracks/7/loop_wrap = true
tracks/7/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [false]
}
tracks/8/type = "value"
tracks/8/imported = false
tracks/8/enabled = true
tracks/8/path = NodePath("Area2D/HitboxTopTotemOnBottom2:position")
tracks/8/interp = 1
tracks/8/loop_wrap = true
tracks/8/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [Vector2(19, 20)]
}
tracks/9/type = "value"
tracks/9/imported = false
tracks/9/enabled = true
tracks/9/path = NodePath("Area2D2/HitboxTopTotem2:disabled")
tracks/9/interp = 1
tracks/9/loop_wrap = true
tracks/9/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [true]
}

[sub_resource type="Animation" id="Animation_4tirh"]
length = 0.001
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("AnimatedSprite2D:animation")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [&"Death"]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("AnimatedSprite2D:frame")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [1]
}

[sub_resource type="Animation" id="Animation_j70eh"]
resource_name = "WalkLeft"
length = 0.8
loop_mode = 1
step = 0.1
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("AnimatedSprite2D:flip_h")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [true]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("Hitbox/HitboxTopTotem:position")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [Vector2(26.5, 2)]
}
tracks/2/type = "value"
tracks/2/imported = false
tracks/2/enabled = true
tracks/2/path = NodePath("HitboxTopTotem:position")
tracks/2/interp = 1
tracks/2/loop_wrap = true
tracks/2/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [Vector2(8, 18)]
}
tracks/3/type = "value"
tracks/3/imported = false
tracks/3/enabled = true
tracks/3/path = NodePath("AnimatedSprite2D:animation")
tracks/3/interp = 1
tracks/3/loop_wrap = true
tracks/3/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [&"Walk"]
}
tracks/4/type = "value"
tracks/4/imported = false
tracks/4/enabled = true
tracks/4/path = NodePath("AnimatedSprite2D:frame")
tracks/4/interp = 1
tracks/4/loop_wrap = true
tracks/4/keys = {
"times": PackedFloat32Array(0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7),
"transitions": PackedFloat32Array(1, 1, 1, 1, 1, 1, 1, 1),
"update": 1,
"values": [0, 1, 2, 3, 4, 5, 6, 7]
}
tracks/5/type = "value"
tracks/5/imported = false
tracks/5/enabled = true
tracks/5/path = NodePath("HitboxTopTotem:disabled")
tracks/5/interp = 1
tracks/5/loop_wrap = true
tracks/5/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [false]
}
tracks/6/type = "value"
tracks/6/imported = false
tracks/6/enabled = true
tracks/6/path = NodePath("Area2D/HitboxTopTotemOnBottom2:disabled")
tracks/6/interp = 1
tracks/6/loop_wrap = true
tracks/6/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [true]
}
tracks/7/type = "value"
tracks/7/imported = false
tracks/7/enabled = true
tracks/7/path = NodePath("Area2D2/HitboxTopTotem2:disabled")
tracks/7/interp = 1
tracks/7/loop_wrap = true
tracks/7/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [false]
}
tracks/8/type = "value"
tracks/8/imported = false
tracks/8/enabled = true
tracks/8/path = NodePath("Area2D2/HitboxTopTotem2:position")
tracks/8/interp = 1
tracks/8/loop_wrap = true
tracks/8/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [Vector2(8, 18)]
}

[sub_resource type="Animation" id="Animation_mxjpe"]
resource_name = "WalkRight"
length = 0.8
loop_mode = 1
step = 0.1
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("AnimatedSprite2D:flip_h")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [false]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("Hitbox/HitboxTopTotem:position")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [Vector2(33.5, 2)]
}
tracks/2/type = "value"
tracks/2/imported = false
tracks/2/enabled = true
tracks/2/path = NodePath("HitboxTopTotem:position")
tracks/2/interp = 1
tracks/2/loop_wrap = true
tracks/2/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [Vector2(19, 18)]
}
tracks/3/type = "value"
tracks/3/imported = false
tracks/3/enabled = true
tracks/3/path = NodePath("AnimatedSprite2D:animation")
tracks/3/interp = 1
tracks/3/loop_wrap = true
tracks/3/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [&"Walk"]
}
tracks/4/type = "value"
tracks/4/imported = false
tracks/4/enabled = true
tracks/4/path = NodePath("AnimatedSprite2D:frame")
tracks/4/interp = 1
tracks/4/loop_wrap = true
tracks/4/keys = {
"times": PackedFloat32Array(0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7),
"transitions": PackedFloat32Array(1, 1, 1, 1, 1, 1, 1, 1),
"update": 1,
"values": [0, 1, 2, 3, 4, 5, 6, 7]
}
tracks/5/type = "value"
tracks/5/imported = false
tracks/5/enabled = true
tracks/5/path = NodePath("HitboxTopTotem:disabled")
tracks/5/interp = 1
tracks/5/loop_wrap = true
tracks/5/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [false]
}
tracks/6/type = "value"
tracks/6/imported = false
tracks/6/enabled = true
tracks/6/path = NodePath("HitboxTopTotemOnBottom:disabled")
tracks/6/interp = 1
tracks/6/loop_wrap = true
tracks/6/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [true]
}
tracks/7/type = "value"
tracks/7/imported = false
tracks/7/enabled = true
tracks/7/path = NodePath("Area2D/HitboxTopTotemOnBottom2:disabled")
tracks/7/interp = 1
tracks/7/loop_wrap = true
tracks/7/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [true]
}
tracks/8/type = "value"
tracks/8/imported = false
tracks/8/enabled = true
tracks/8/path = NodePath("Area2D/HitboxTopTotemOnBottom2:position")
tracks/8/interp = 1
tracks/8/loop_wrap = true
tracks/8/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [Vector2(19, 20)]
}
tracks/9/type = "value"
tracks/9/imported = false
tracks/9/enabled = true
tracks/9/path = NodePath("Area2D2/HitboxTopTotem2:disabled")
tracks/9/interp = 1
tracks/9/loop_wrap = true
tracks/9/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [false]
}
tracks/10/type = "value"
tracks/10/imported = false
tracks/10/enabled = true
tracks/10/path = NodePath("Area2D2/HitboxTopTotem2:position")
tracks/10/interp = 1
tracks/10/loop_wrap = true
tracks/10/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [Vector2(19, 18)]
}

[sub_resource type="AnimationLibrary" id="AnimationLibrary_01ote"]
_data = {
"Death": SubResource("Animation_n5fbe"),
"OnBottomTotemLeft": SubResource("Animation_lc66n"),
"OnBottomTotemRight": SubResource("Animation_sik2m"),
"RESET": SubResource("Animation_4tirh"),
"WalkLeft": SubResource("Animation_j70eh"),
"WalkRight": SubResource("Animation_mxjpe")
}

[sub_resource type="RectangleShape2D" id="RectangleShape2D_snfmy"]
size = Vector2(16, 24)

[node name="TopTotemClaquette" type="CharacterBody2D" groups=["TopTotemClaquette"]]
collision_layer = 3
script = SubResource("GDScript_omxb6")

[node name="HitboxTopTotem" type="CollisionShape2D" parent="."]
position = Vector2(19, 18)
shape = SubResource("RectangleShape2D_fvexe")
disabled = true

[node name="Hitbox" type="Area2D" parent="."]
position = Vector2(-17, 0)
collision_layer = 0
collision_mask = 128

[node name="HitboxTopTotem" type="CollisionShape2D" parent="Hitbox"]
position = Vector2(23.5, 8)
shape = SubResource("RectangleShape2D_ccwdb")

[node name="AnimatedSprite2D" type="AnimatedSprite2D" parent="."]
position = Vector2(13, 12.5)
scale = Vector2(0.150794, 0.157718)
sprite_frames = SubResource("SpriteFrames_7xa0i")
animation = &"Death"
frame = 1
flip_h = true

[node name="DetectionAreaPlayer" type="Area2D" parent="."]
collision_layer = 0
collision_mask = 128

[node name="CollisionShape2D" type="CollisionShape2D" parent="DetectionAreaPlayer"]
position = Vector2(18, 18)
shape = SubResource("RectangleShape2D_8uf4e")

[node name="DetectionAreaBottomTotem" type="Area2D" parent="."]

[node name="CollisionShape2D" type="CollisionShape2D" parent="DetectionAreaBottomTotem"]
position = Vector2(16, 18)
shape = SubResource("CircleShape2D_bgbfj")

[node name="ProjectileTimer" type="Timer" parent="."]
wait_time = 2.0

[node name="AnimationPlayer" type="AnimationPlayer" parent="."]
libraries = {
"": SubResource("AnimationLibrary_01ote")
}

[node name="HitboxTopTotemOnBottom" type="CollisionShape2D" parent="."]
position = Vector2(6, 20)
shape = SubResource("RectangleShape2D_snfmy")

[node name="Stun" type="Timer" parent="."]
one_shot = true

[node name="Area2D" type="Area2D" parent="."]
collision_layer = 0
collision_mask = 128

[node name="HitboxTopTotemOnBottom2" type="CollisionShape2D" parent="Area2D"]
position = Vector2(6, 20)
shape = SubResource("RectangleShape2D_snfmy")

[node name="Area2D2" type="Area2D" parent="."]
collision_layer = 0
collision_mask = 128

[node name="HitboxTopTotem2" type="CollisionShape2D" parent="Area2D2"]
position = Vector2(8, 18)
shape = SubResource("RectangleShape2D_fvexe")
disabled = true

[connection signal="body_entered" from="Hitbox" to="." method="_on_hitbox_body_entered"]
[connection signal="body_entered" from="DetectionAreaPlayer" to="." method="_on_detection_area_player_body_entered"]
[connection signal="body_exited" from="DetectionAreaPlayer" to="." method="_on_detection_area_player_body_exited"]
[connection signal="body_entered" from="DetectionAreaBottomTotem" to="." method="_on_detection_area_bottom_totem_body_entered"]
[connection signal="body_exited" from="DetectionAreaBottomTotem" to="." method="_on_detection_area_bottom_totem_body_exited"]
[connection signal="timeout" from="ProjectileTimer" to="." method="_on_projectile_timer_timeout"]
[connection signal="area_entered" from="Area2D" to="." method="_on_area_2d_area_entered"]
[connection signal="area_entered" from="Area2D2" to="." method="_on_area_2d_2_area_entered"]
